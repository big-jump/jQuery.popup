/**
 *  jQuery.popup plugin -- modal popup, content loaded with AJAX request
 *  Copyright (c) 2010 Wayne Walls - wfwalls(at)gmail(dot)com
 *  License: MIT License or GNU General Public License (GPL) Version 2
 *  Date: 29 August 2010
 *  @author Wayne Walls
 *  @version 0.92
 *
 * DEPENDENCY: jQuery.servercomm plugin
 * [ http://github.com/waynewalls/jquery.servercomm ]
 *
 */
;(function(g,k,e){var b=(function(){var p,n=3,q=k.createElement("div"),o=q.getElementsByTagName("i");do{q.innerHTML="<!--[if gt IE "+(++n)+"]><i></i><![endif]-->"}while(o[0]);return n>4?n:p}()),a=[(b===6)?"body { background-image: url(images/clear1.gif) fixed; }":"",".ww-popup-matte{ display:none; background-color:black; width:100%; height:100%;",(b===6)?"position: absolute; left: expression((document.documentElement || document.body).scrollLeft); top: expression((document.documentElement || document.body).scrollTop);":"position:fixed; left:0; top:0px;","}",".ww-popup-container{ display:none; background-color:white; border-bottom:ridge #88afff 4px; overflow:hidden;",(b===6)?"position: absolute;":"position:fixed;","}",".ww-popup-titlebar { height:25px; background-image:url(images/titlebar.png); }",".ww-popup-title { font-weight:bold; color:white; padding-left:5px; position:relative; top:4px; }",".ww-popup-close { cursor:pointer; padding-right:20px; position:absolute; right:3px; top:4px; background: url(images/close.gif) center right no-repeat; }",".ww-popup-close-label { color:white; text-decoration:underline; position:relative; top:-1px; }"].join(""),i=e("<style />").attr("type","text/css"),h=[],f=null,m=null,j=null,c=function(){var r=75,n=50,o=e(g).height()-r-n,p=j.outerHeight(),q=(p>o)?o:p;return{top:r,height:q}},d=function(){var p,o,n=e.popup.options;j.remove();j=null;if(h.length!==0){j=h.shift();j.appendTo(k.body);o=(e(g).width()-j.width())/2;if(b===6){p=c();j[0].style.setExpression("top","(document.documentElement || document.body).scrollTop + "+p.top);j[0].style.setExpression("left","(document.documentElement || document.body).scrollLeft + "+o)}else{j.css({left:o})}}else{f.slideUp("normal",function(){f.remove();f=null})}if(n.closeCallback&&e.isFunction(n.closeCallback)){n.closeCallback.apply((j)?j[0]:null,(n.closeArgs||[null]))}if(h.length!==0){e.popup.options=e.extend(e.popup.options,h.pop())}},l=function(){var n=e(g),o=e.popup.options,q,p;j=e("<div />",{"class":"ww-popup-container"}).append(e("<div />",{"class":"ww-popup-titlebar"}));j.find("div.ww-popup-titlebar").append(e("<span />",{"class":"ww-popup-title",text:o.title})).append(e("<span />",{"class":"ww-popup-close",title:"close",html:"<span class='ww-popup-close-label'>close</span>"}).click(d));j.append(m).css("display","block").appendTo(k.body);if(typeof o.width==="number"){j.css("width",o.width)}else{j.css("width",600)}if(j.outerWidth()>=n.width()){j.width(n.width()-20);m.css("width","auto").css("overflow-x","scroll")}q=c();p=(n.width()-j.width())/2;if(b===6){j[0].style.setExpression("top","(document.documentElement || document.body).scrollTop + "+q.top);j[0].style.setExpression("left","(document.documentElement || document.body).scrollLeft + "+p)}else{j.css("top",q.top).css("left",p)}j.height(q.height);m.height(q.height-j.find("div:first-child").outerHeight()-(parseInt(m.css("padding-top"),10)+parseInt(m.css("padding-bottom"),10)));if(o.successCallback&&e.isFunction(o.successCallback)){o.successCallback.apply(j[0],(o.successArgs||[null]))}};e(g).bind("resize.ww-popup-event",function(){var n=e(g),o;if(f){o=(n.width()-j.width())/2;if(b===6){j[0].style.setExpression("left","(document.documentElement || document.body).scrollLeft + "+o);f.css({width:n.width(),height:n.height()})}else{j.css({left:o})}}});e(k).ready(function(){if(i[0].styleSheet){i[0].styleSheet.cssText=a}else{i.text(a)}i.prependTo("head")});e.popup={options:{url:"",title:"",width:600,successCallback:null,successArgs:null,closeCallback:null,closeArgs:null},configure:function(n){n=n||{};this.options=e.extend(this.options,n)},popupOpen:function(){return(j!==null)},show:function(p){var o=e(g),n;if(j){h.push(j.detach());h.push(e.extend(n,this.options))}p=p||{};this.options=e.extend(this.options,p);e.serverComm.contactServer({url:e.popup.options.url,method:"GET",successCallback:function(q){m=e(q.split("|")[1]);if(f===null){f=e("<div />",{"class":"ww-popup-matte",css:{opacity:0.7}}).appendTo(k.body);if(b===6){f.css({height:o.height(),width:o.width()})}f.slideDown("normal",l)}else{l()}}})}}}(window,document,jQuery));